---
title: 前端微服务
abbrlink: d0a9039b
date: 2021-01-04 10:28:37
tags:
  - 技术积累
  - 前端
  - js
categories:
  - 技术积累
  - 前端
  - js
toc: true
---

![首屏图](https://s3.ax1x.com/2021/01/12/sG4uY8.jpg)

<!-- more -->

## 概念

本质上前端微服务就是把一个大型的应用拆分为很多个独立的模块，每一个模块的可以单独的开发、调试并上线。

## 优势

* 每个模块都是一个独立的个体，如果有某个模块出现问题了，不会导致整个应用挂掉。
* 由于每个模块可以单独上线，因此上线会更快，有利于更新迭代。
* 由于有了服务注册的功能，因此页面都可以通过配置化的方式来动态加载，对于功能的新增、回滚特别方便。
* 框架无关(这可能取决于具体实现)，每个模块间可以使用不同的框架(但不推荐这样做)。

## 实现方式

### 服务发现

首先，我们来思考一个问题。如果我们将一个大型应用拆分为多个模块的话，那主程序怎么知道有哪些模块，
以及各个模块对应的配置信息(js / css 等配置信息)呢。其实，查找配置的模块信息的过程，就叫做服务发现。

> 那么我们怎么实现服务发现呢?

#### 方式一

有一种很简单粗暴的做法，就是我们将这些配置信息直接硬编码在主程序里面。AIOT、AIMS项目使用的是这个方式。
通过基座stack项目，进行登录鉴权管理，并开放对应权限的路由进行子应用跳转。

> 注：子项目的加载使用的useSpring是用来编写react的动画的

可查看[react-spring的使用](/archives/202101044fbd9ce8/)

项目选型为飞冰团队的[icestark](https://ice.work/docs/icestark/about)，可查看[icestark的使用](/archives/20210105b721b7cb/)

可是这样造成的问题是什么呢？每一次你要新增、修改和删除模块的话，你都需要发布一次主程序。

> 除了写死在主程序中，有没有其他更好的办法呢？

#### 方式二

这个时候比较聪明的同学可能就想到了，那我把配置信息通过接口的方式调用不就行了？我个人比较推荐的也是这种做法。
因此有时候我们需要根据用户的身份、权限来返回不同的模块配置信息，通过接口的话，我们就可以很方便的做到这一点。我给一个简单的模块配置信息模块：

```json
[{
    name: 'home',
    path: '/home',
    js: 'https://unpkg.com/react@16/umd/react.development.js',
    css: 'https://unpkg.com/react@16/umd/react.css'
}]
```

复制代码配置信息主要分为四项，path 指的是该模块对应的路由地址，也就是说，当前端匹配到路由为 /home 的时候，就会加载对应的 js 文件和 css 文件，并执行对应的 js 文件，渲染模块内容。

### 动态加载模块

#### new Function

##### 基础知识

##### F实现步骤

#### AMD

##### A实现步骤

#### 路由监听

## 参考资料

* [ucf-web 微前端框架使用手册](https://www.yuque.com/ucf-web/book)
* [github icestark](https://github.com/ice-lab/icestark)
* [前端微服务简单实践](https://juejin.cn/post/6844904088757370887)
* [面向大型工作台的微前端解决方案 icestark](https://zhuanlan.zhihu.com/p/88449415)
