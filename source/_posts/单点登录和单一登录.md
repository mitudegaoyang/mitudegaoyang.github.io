---
title: 单点登录和单一登录
abbrlink: 771a976
date: 2021-03-15 09:08:15
tags:
  - 技术积累
  - SSO
  - 单点登录
  - 单一登录
categories:
  - 技术积累
  - 前端
toc: true
---

![首屏图](https://s3.ax1x.com/2021/03/15/6BwwuD.jpg)

<!-- more -->

## 单点登录和单一登录

### 单点登录

单点登录是登录之后，所有该域名的网站都可以不用登录了，包括子域名。

单点登录是从一个系统登录以后，其他地方不用登录。

单点登录（Single Sign On），简称为 SSO，是目前比较流行的企业业务整合的解决方案之一。
SSO的定义是在多个应用系统中，用户只需要登录一次就可以访问所有相互信任的应用系统。

较大的企业内部，一般都有很多的业务支持系统为其提供相应的管理和IT服务

单点登录的机制也一样，如下图所示，当用户第一次访问应用系统1的时候，因为还没有登录，
会被引导到认证系统中进行登录（1）；根据用户提供的登录信息，认证系统进行身份效验，
如果通过效验，应该返回给用户一个认证的凭据－－ticket（2）；
用户再访问别的应用的时候（3，5）就会将这个ticket带上，作为自己认证的凭据，
应用系统接受到请求之后会把ticket送到认证系统进行效验，检查ticket的合法性（4，6）。
如果通过效验，用户就可以在不用再次登录的情况下访问应用系统2和应用系统3了。
[重点是Ticket,参考中国电信，重点还有 认证中心]

![单点登录](https://s3.ax1x.com/2021/03/15/6B0mad.gif)

从上面的视图可以看出，要实现SSO，需要以下主要的功能：

* 所有应用系统共享一个身份认证系统。
  统一的认证系统是SSO的前提之一。认证系统的主要功能是将用户的登录信息和用户信息库相比较，对用户进行登录认证；认证成功后，认证系统应该生成统一的认证标志（ticket），返还给用户。另外，认证系统还应该对ticket进行效验，判断其有效性。
* 所有应用系统能够识别和提取ticket信息
  要实现SSO的功能，让用户只登录一次，就必须让应用系统能够识别已经登录过的用户。应用系统应该能对ticket进行识别和提取，通过与认证系统的通讯，能自动判断当前用户是否登录过，从而完成单点登录的功能。
* 统一的认证系统并不是说只有单个的认证服务器，如下图所示，整个系统可以存在两个以上的认证服务器，这些服务器甚至可以是不同的产品。认证服务器之间要通过标准的通讯协议，互相交换认证信息，就能完成更高级别的单点登录。如下图，当用户在访问应用系统1时，由第一个认证服务器进行认证后，得到由此服务器产生的ticket。当他访问应用系统4的时候，认证服务器2能够识别此ticket是由第一个服务器产生的，通过认证服务器之间标准的通讯协议（例如SAML）来交换认证信息，仍然能够完成SSO的功能。

![单点登录](https://s3.ax1x.com/2021/03/15/6B0KPI.gif)

### 单一登录，单账号单ip登录策略

用是`Cache.Insert(key(用户名),value(用户名),时间为(session.Timeout))`;

```js
if(Cache["key"]==用户名)
response.write(己经登录)
```

我说一个比较普遍的做法，我看过很多项目就是这么干的，是可行的。用一个Application存储一个Table，
Table里记录username,sessionid,time，那么在正式登陆之前就检查这个Table就可以了。
用户退出，可以根据这个Table移除记录，session、timeout可以根据sessionid移除记录。

服务器中断了 Application也就没了...这个思路应该可以帮你解决

放在服务器缓存中就可以。再次登录的时候判断当前用户列表中有没有，有的话，说明已经登录。

如果楼主说的一机一号的机制，那么可以直接绑定用户首次登录的IP地址，将用户的IP地址绑定在数据库中，
每次登录的时候判断IP是否正确。如用户是IP是自动获取的话，那么就绑定用户的硬件串口号。
要做成QQ那种形式的话可以在数据库中加字段来表明，帐号是否属于登录的状态。

用缓存+session控制,如果缓存存在，则不让另外地方登录

每次登录都自动更新一次随机密码，也就是在用户表中 usrId usrName usrPass usrRanPass ，
用户每次登录后把随机密码记录 Cookie 或 session 中 （包括用户ID），
然后每次刷新页面的时候用 UsrId 与 UsrRanPass 与数据库进行对比。如果随机密码不同则退出，也可以设为定时对比。

webform? 登录的时候提取一个sessionID 保存在数据库里 ajax和服务器保持联络，
检测服务器上的登录记录，当另一个用户登录的时候数据库的sessionID就会被现在登录的用户生存的sessionID替换掉，
那当ajax和服务器通信时匹配数据库里的sessionID不同时就提示。

据说sessionID是唯一的...实在不行就用guid生成一个也一样...不知道有没有说错

系统中一个LoginSession表（sessionId,UserId,ip,expireDate)

登录成功后，检查单点登录策略，如果当前是不允许多个地方登录，那么就清空LoginSession中当前UesrId的记录。
同时把当前Session记录起来，同时返回一个token{sessionId,userId}给客户端。

每次和服务端的请求，都要到LoginSession中校验这个token，看是否存在（被踢啦），是否过期（expireDate），是否被限定的Ip地址。

如果Ok的话，修改expireDate，再延迟20分钟之类

上述接近方案，可以实现：踢人，限定Ip，登录超时的问题

## 参考资料

* [单点登录和单一登录的区别？](https://www.cnblogs.com/x-poior/p/6200919.html)
